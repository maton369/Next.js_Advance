"use client";

/**
 * GlobalError（グローバルエラーバウンダリ用 UI）
 *
 * - Next.js App Router では、`error.tsx`（または `global-error.tsx`）を置くことで
 *   そのセグメント配下で発生したエラーを捕捉し、専用のフォールバックUIを表示できる。
 *
 * - このコンポーネントはエラー発生時に表示される “最後の受け皿” であり、
 *   通常の Page/Layouts が例外で落ちたときに代わりにレンダリングされる。
 *
 * 重要：なぜ `"use client"` が必要か？
 * - `reset()` はユーザー操作（クリック）により実行する必要があるため、
 *   onClick を持つこのコンポーネントは Client Component である必要がある。
 * - エラーバウンダリのフォールバックUIは「ブラウザで再試行できる」ことが価値なので、
 *   クライアント実行に寄るのが基本。
 *
 * アルゴリズム的な見方（例外 → フォールバック → 再試行）：
 * 1. ルート配下のどこかで例外が発生する（レンダリング中/データ取得中など）
 * 2. Next.js がそのエラーを捕捉し、GlobalError をフォールバックとして表示する
 * 3. ユーザーが「Try again」をクリックする
 * 4. `reset()` が呼ばれ、エラー状態がリセットされ、該当セグメントの再レンダリングが試みられる
 */
export default function GlobalError({
  reset,
}: {
  /**
   * error（発生したエラーオブジェクト）
   *
   * - Next.js が捕捉したエラーが渡される。
   * - `digest` は Next.js が付与する識別子（環境により付くことがある）で、
   *   同一種のエラーをまとめたり、ログと突合する用途に使える。
   *
   * 注意：
   * - このサンプルでは error を UI に表示していないが、
   *   開発時はデバッグ表示、本番ではユーザーに詳細を出さない、などの方針が一般的。
   */
  error: Error & { digest?: string };

  /**
   * reset（再試行関数）
   *
   * - エラー境界を “リセット” して、該当ルートの再描画を試みるための関数。
   * - 典型的には一時的なネットワーク障害や、取得失敗から復帰できる可能性がある場合に有効。
   *
   * アルゴリズム的には：
   * - 入力：ユーザーのクリック
   * - 処理：reset() を呼ぶ
   * - 出力：エラー状態がクリアされ、再レンダリングが走る
   */
  reset: () => void;
}) {
  return (
    /**
     * <html> / <body> を含めている理由（グローバルエラーの特徴）
     *
     * - GlobalError は “アプリ全体レベル” のフォールバックとして機能するため、
     *   通常の layout が崩壊している状況でも最低限の HTML 構造を返せるように
     *   <html> と <body> を明示するパターンがある。
     *
     * - ここはプロジェクトの設計によって、より装飾したり共通レイアウトを一部再現することもある。
     */
    <html>
      <body>
        {/**
         * エラーメッセージ（ユーザー向けの簡易表示）
         *
         * - ここでは詳細を出さずに汎用メッセージのみ表示している。
         * - 本番運用では「再試行」「トップへ戻る」「問い合わせ導線」などを用意すると親切。
         */}
        <h2>Something went wrong!</h2>

        {/**
         * 再試行ボタン
         *
         * - onClick はブラウザイベントなので Client Component である必要がある（"use client" が必須）。
         * - `reset()` を呼ぶことで、エラー境界の状態が初期化され、
         *   そのセグメントのレンダリングが再度試行される。
         *
         * アルゴリズム：
         * 1. ユーザーがボタンをクリック
         * 2. onClick ハンドラが呼ばれる
         * 3. reset() を実行してエラー状態をリセット
         * 4. ルートが再レンダリングされ、成功すれば通常画面へ戻る
         */
        <button onClick={() => reset()}>Try again</button>
      </body>
    </html>
  );
}